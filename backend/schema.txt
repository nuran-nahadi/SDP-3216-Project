CREATE TABLE public.events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  title text NOT NULL,
  description text,
  start_time timestamp with time zone NOT NULL,
  end_time timestamp with time zone NOT NULL,
  location text,
  tags jsonb,
  is_all_day boolean NOT NULL DEFAULT false,
  reminder_minutes integer CHECK (reminder_minutes IS NULL OR reminder_minutes >= 0),
  recurrence_rule text,
  color text CHECK (color IS NULL OR color ~ '^#[0-9A-Fa-f]{6}$'::text),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT events_pkey PRIMARY KEY (id),
  CONSTRAINT events_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.expenses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  amount double precision NOT NULL,
  currency text NOT NULL DEFAULT 'Taka'::text,
  category USER-DEFINED NOT NULL,
  subcategory text,
  merchant text,
  description text,
  date timestamp with time zone NOT NULL,
  payment_method USER-DEFINED,
  receipt_url text,
  is_recurring boolean NOT NULL DEFAULT false,
  recurrence_rule text,
  tags jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT expenses_pkey PRIMARY KEY (id),
  CONSTRAINT expenses_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.journal_entries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  title text,
  content text NOT NULL,
  mood USER-DEFINED,
  sentiment_score double precision,
  keywords text,
  summary text,
  weather text,
  location text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT journal_entries_pkey PRIMARY KEY (id),
  CONSTRAINT journal_entries_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.tasks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  title text NOT NULL,
  description text,
  due_date timestamp with time zone,
  priority USER-DEFINED NOT NULL DEFAULT 'medium'::task_priorities,
  status USER-DEFINED NOT NULL DEFAULT 'pending'::task_statuses,
  is_completed boolean NOT NULL DEFAULT false,
  completion_date timestamp with time zone,
  estimated_duration integer CHECK (estimated_duration IS NULL OR estimated_duration > 0),
  actual_duration integer CHECK (actual_duration IS NULL OR actual_duration > 0),
  tags jsonb,
  parent_task_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT tasks_pkey PRIMARY KEY (id),
  CONSTRAINT tasks_parent_task_id_fkey FOREIGN KEY (parent_task_id) REFERENCES public.tasks(id),
  CONSTRAINT tasks_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.user_preferences (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  default_task_priority USER-DEFINED NOT NULL DEFAULT 'medium'::task_priorities,
  default_expense_currency text NOT NULL DEFAULT 'USD'::text,
  notification_settings jsonb,
  theme USER-DEFINED NOT NULL DEFAULT 'auto'::themes,
  language text NOT NULL DEFAULT 'en'::text,
  date_format text NOT NULL DEFAULT 'YYYY-MM-DD'::text,
  time_format USER-DEFINED NOT NULL DEFAULT '12h'::time_formats,
  week_start_day USER-DEFINED NOT NULL DEFAULT 'monday'::week_start_days,
  ai_insights_enabled boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_preferences_pkey PRIMARY KEY (id),
  CONSTRAINT user_preferences_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
username text NOT NULL UNIQUE,
  email text NOT NULL UNIQUE,
  first_name text NOT NULL,
  last_name text NOT NULL,
  hashed_password text NOT NULL,
  is_verified boolean NOT NULL DEFAULT false,
  profile_picture_url text,
  timezone text NOT NULL DEFAULT 'UTC'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  role USER-DEFINED NOT NULL DEFAULT 'user'::user_roles,
  is_active boolean NOT NULL DEFAULT true,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);